#!/usr/bin/env bash

sltime=30
low_level=10
critical_level=5
low_warn=0
critical_warn=0
full=0

while true; do
    status="$(cat /sys/class/power_supply/BAT0/status)"

    if [[ "$status" != "Discharging" ]]; then
        low_warn=0
        critical_warn=0

        if [[ "$status" == "Full" ]] && ! ((full)); then
            dunstify -a "Batería cargada" "La batería está completamente cargada (100%)."
            full=1
        fi
    else
        full=0

        if ! ((critical_warn)); then
            capacity=$(cat /sys/class/power_supply/BAT0/capacity)

            if [[ $capacity -le $critical_level ]]; then
                dunstify -u critical -a "Batería muy baja" "La batería está al $critical_level% o menos."
                critical_warn=1
            elif [[ $capacity -le $low_level ]] && ! ((low_warn)); then
                dunstify -a "Batería baja" "La batería está al $low_level% o menos."
                low_warn=1
            fi
        fi
    fi

    sleep $sltime
done
