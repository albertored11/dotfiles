#!/usr/bin/env bash

sltime=30
low_level=10
critical_level=5
low_warn=0
critical_warn=0

while true; do
    sleep $sltime

    charging="$(cat /sys/class/power_supply/BAT0/status)"

    if [[ "$charging" != "Discharging" ]]; then
        low_warn=0
        critical_warn=0
        continue
    fi

    ((critical_warn)) && continue

    bat_cap=$(cat /sys/class/power_supply/BAT0/capacity)

    if [[ $bat_cap -le $critical_level ]]; then
        dunstify -u critical -a "Batería muy baja" "La batería está al $critical_level% o menos."
        critical_warn=1
    elif [[ $bat_cap -le $low_level ]] && ! ((low_warn)); then
        dunstify -a "Batería baja" "La batería está al $low_level% o menos."
        low_warn=1
    fi
done
