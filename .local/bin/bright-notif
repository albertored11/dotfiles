#!/usr/bin/env bash

usage() {
    echo "usage: $(basename "$0") <up/down>" >&2
    exit 1
}

[[ "$#" -eq 1 ]] || usage

pb="/tmp/prev-bright"

case "$1" in
    up)
        if [[ -f "$pb" ]]; then
            brightnessctl -q set "$(cat $pb)"
            rm "$pb"
        else
            brightnessctl -q set 5%+
        fi
    ;;
    down)
        brightnessctl -q set 5%-
    ;;
    off)
        brightnessctl i -m | awk -F "," '{ print $4 }' > "$pb"
        brightnessctl -q set 0
    ;;
    min)
        brightnessctl -q set 1
    ;;
esac

bright="$(awk -F "," '{ print substr($4, 1, length($4) - 1) }' <(brightnessctl i -m))"

echo "$bright" >> /tmp/xobbrightness
